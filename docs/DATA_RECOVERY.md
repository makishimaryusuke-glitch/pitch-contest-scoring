# データ復旧ガイド

## データが消えてしまった場合の復旧方法

### 方法1: バックアップファイルからの復元（推奨）

1. **以前にダウンロードしたバックアップファイルを用意**
   - バックアップファイルは`.zip`形式です
   - ファイル名は`pitch_contest_backup_YYYYMMDD_HHMMSS.zip`の形式です

2. **アプリにアクセス**
   - Streamlit Cloudのアプリにアクセス
   - 「💾 データ管理」ページを開く

3. **バックアップファイルをアップロード**
   - 「📤 バックアップからの復元」セクションで
   - 「バックアップファイルを選択」からファイルを選択
   - 「復元を実行」ボタンをクリック

4. **復元の確認**
   - 復元が成功すると、すべてのデータが復元されます
   - 各ページでデータが表示されることを確認してください

### 方法2: Gitリポジトリからの復元

データファイルをGitリポジトリにコミットしている場合：

1. **GitHubリポジトリにアクセス**
   - リポジトリの`data/`ディレクトリを確認
   - 以下のファイルが存在するか確認：
     - `schools.json`
     - `submissions.json`
     - `evaluation_results.json`
     - `evaluation_details.json`
     - `files.json`

2. **データファイルをダウンロード**
   - GitHubから各JSONファイルをダウンロード
   - または、リポジトリをクローンして`data/`ディレクトリを取得

3. **バックアップファイルを作成**
   - ダウンロードしたJSONファイルをZIP形式で圧縮
   - または、`utils/backup_restore.py`の`create_backup()`関数を使用

4. **方法1の手順に従って復元**

### 方法3: 手動での復元

JSONファイルを直接編集する場合：

1. **データファイルの場所を確認**
   - ローカル環境: `data/`ディレクトリ
   - Streamlit Cloud: 一時的なファイルシステム

2. **JSONファイルを直接編集**
   - 各JSONファイルをテキストエディタで開く
   - データを追加・編集
   - ファイルを保存

3. **アプリを再起動**
   - Streamlit Cloudの場合は再デプロイが必要

## データを失わないための対策

### 1. 定期的なバックアップ

- **推奨頻度**: 重要なデータ入力後、または1日1回
- **バックアップ方法**: 「💾 データ管理」ページからバックアップをダウンロード
- **保存場所**: 安全な場所（クラウドストレージ、外部HDDなど）

### 2. Gitリポジトリへのコミット

データファイルをGitリポジトリにコミットすることで、永続化できます：

```bash
# .gitignoreでdata/*.jsonをコメントアウト
git add data/*.json
git commit -m "データファイルを追加"
git push origin main
```

**注意**: 個人情報を含む可能性がある場合は、リポジトリをプライベートにすることをお勧めします。

### 3. 外部ストレージの使用（高度）

Google Drive、AWS S3、Supabaseなどの外部ストレージを使用する方法もあります。詳細は`docs/DATA_PERSISTENCE.md`を参照してください。

## トラブルシューティング

### Q: バックアップファイルが見つからない

A: 残念ながら、バックアップファイルがない場合はデータの復旧はできません。今後は定期的にバックアップを取ることをお勧めします。

### Q: 復元が失敗する

A: 以下の点を確認してください：
- バックアップファイルが正しい形式（ZIP）であること
- バックアップファイルが破損していないこと
- アプリに十分な権限があること

### Q: 一部のデータだけ復元したい

A: バックアップファイルを解凍して、必要なJSONファイルだけを手動で復元できます。

## データの構造

各データファイルの構造：

- **schools.json**: 参加校の情報
- **submissions.json**: 提出資料の情報
- **evaluation_results.json**: 採点結果の情報
- **evaluation_details.json**: 採点詳細の情報
- **files.json**: アップロードされたファイルの情報

各ファイルはJSON配列形式で、各要素はID、作成日時、更新日時などのメタデータを含みます。
